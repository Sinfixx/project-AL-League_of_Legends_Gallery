@if (hero) {
<div class="hero-detail">
  <h2>{{ hero.name }} Details</h2>

  <div class="hero-info">
    <div class="info-item"><span>ID:</span> {{ hero.id }}</div>
    <div class="info-item"><span>Nom:</span> {{ hero.name }}</div>
    @if (selectedWeapon) {
    <div class="info-item weapon-equipped">
      <span>üó°Ô∏è Arme √©quip√©e:</span> {{ selectedWeapon.name }}
    </div>
    }
  </div>

  <form [formGroup]="heroForm" (ngSubmit)="onSubmit()" class="hero-form">
    <div class="stats-section">
      <h3>Caract√©ristiques (Total: {{ getTotalPoints() }}/40)</h3>

      <div class="points-remaining">
        Points restants:
        <span
          class="points-value"
          [class.warning]="getRemainingPoints() < 0"
          [class.success]="getRemainingPoints() === 0 && getTotalPoints() === 40"
        >
          {{ getRemainingPoints() }}
        </span>
      </div>

      <!-- S√©lection d'arme -->
      <div class="weapon-selection">
        <h4>üó°Ô∏è √âquipement</h4>
        <div class="weapon-control">
          <label for="weapon">Arme:</label>
          <select
            id="weapon"
            formControlName="weapon"
            (change)="onWeaponChange()"
            [class.error]="!canEquipSelectedWeapon()"
          >
            <option value="">Aucune arme</option>
            <option
              *ngFor="let weapon of weapons"
              [value]="weapon.id"
              [disabled]="!heroService.canEquipWeapon(hero, weapon)"
            >
              {{ weapon.name }}
              ({{ weapon.attaque >= 0 ? '+' : '' }}{{ weapon.attaque }}/{{
                weapon.esquive >= 0 ? '+' : ''
              }}{{ weapon.esquive }}/{{ weapon.degats >= 0 ? '+' : '' }}{{ weapon.degats }}/{{
                weapon.pv >= 0 ? '+' : ''
              }}{{ weapon.pv }})
            </option>
          </select>
        </div>

        @if (!canEquipSelectedWeapon()) {
        <div class="weapon-error">‚ö†Ô∏è {{ getEquipmentError() }}</div>
        } @if (selectedWeapon) {
        <div class="weapon-preview">
          <h5>Aper√ßu avec {{ selectedWeapon.name }}:</h5>
          <div class="stats-comparison">
            <div class="stat-compare">
              <span>ATQ:</span>
              <span class="base-stat">{{ hero.attaque }}</span>
              <span
                class="modifier"
                [class]="selectedWeapon.attaque >= 0 ? 'positive' : 'negative'"
              >
                {{ selectedWeapon.attaque >= 0 ? '+' : '' }}{{ selectedWeapon.attaque }}
              </span>
              <span class="final-stat" [class.invalid]="finalStats!.attaque < 1">
                = {{ finalStats!.attaque }}
              </span>
            </div>
            <div class="stat-compare">
              <span>ESQ:</span>
              <span class="base-stat">{{ hero.esquive }}</span>
              <span
                class="modifier"
                [class]="selectedWeapon.esquive >= 0 ? 'positive' : 'negative'"
              >
                {{ selectedWeapon.esquive >= 0 ? '+' : '' }}{{ selectedWeapon.esquive }}
              </span>
              <span class="final-stat" [class.invalid]="finalStats!.esquive < 1">
                = {{ finalStats!.esquive }}
              </span>
            </div>
            <div class="stat-compare">
              <span>D√âG:</span>
              <span class="base-stat">{{ hero.degats }}</span>
              <span class="modifier" [class]="selectedWeapon.degats >= 0 ? 'positive' : 'negative'">
                {{ selectedWeapon.degats >= 0 ? '+' : '' }}{{ selectedWeapon.degats }}
              </span>
              <span class="final-stat" [class.invalid]="finalStats!.degats < 1">
                = {{ finalStats!.degats }}
              </span>
            </div>
            <div class="stat-compare">
              <span>PV:</span>
              <span class="base-stat">{{ hero.pv }}</span>
              <span class="modifier" [class]="selectedWeapon.pv >= 0 ? 'positive' : 'negative'">
                {{ selectedWeapon.pv >= 0 ? '+' : '' }}{{ selectedWeapon.pv }}
              </span>
              <span class="final-stat" [class.invalid]="finalStats!.pv < 1">
                = {{ finalStats!.pv }}
              </span>
            </div>
          </div>
        </div>
        }
      </div>

      <div class="stats-grid">
        <!-- Attaque -->
        <div class="stat-item">
          <label for="attaque">Attaque:</label>
          <div class="stat-control">
            <button
              type="button"
              (click)="decrementStat('attaque')"
              [disabled]="attaqueControl?.value <= 1"
            >
              -
            </button>
            <input
              id="attaque"
              type="number"
              formControlName="attaque"
              min="1"
              max="40"
              [class.error]="hasError('attaque', 'min') || hasError('attaque', 'max')"
            />
            <button
              type="button"
              (click)="incrementStat('attaque')"
              [disabled]="getRemainingPoints() <= 0"
            >
              +
            </button>
          </div>
          <div class="stat-bar">
            <div
              class="stat-fill"
              [style.width.%]="((attaqueControl?.value || 0) / 40) * 100"
            ></div>
          </div>
          @if (hasError('attaque', 'min') || hasError('attaque', 'max')) {
          <div class="field-error">{{ getErrorMessage('attaque') }}</div>
          }
        </div>

        <!-- Esquive -->
        <div class="stat-item">
          <label for="esquive">Esquive:</label>
          <div class="stat-control">
            <button
              type="button"
              (click)="decrementStat('esquive')"
              [disabled]="esquiveControl?.value <= 1"
            >
              -
            </button>
            <input
              id="esquive"
              type="number"
              formControlName="esquive"
              min="1"
              max="40"
              [class.error]="hasError('esquive', 'min') || hasError('esquive', 'max')"
            />
            <button
              type="button"
              (click)="incrementStat('esquive')"
              [disabled]="getRemainingPoints() <= 0"
            >
              +
            </button>
          </div>
          <div class="stat-bar">
            <div
              class="stat-fill"
              [style.width.%]="((esquiveControl?.value || 0) / 40) * 100"
            ></div>
          </div>
          @if (hasError('esquive', 'min') || hasError('esquive', 'max')) {
          <div class="field-error">{{ getErrorMessage('esquive') }}</div>
          }
        </div>

        <!-- D√©g√¢ts -->
        <div class="stat-item">
          <label for="degats">D√©g√¢ts:</label>
          <div class="stat-control">
            <button
              type="button"
              (click)="decrementStat('degats')"
              [disabled]="degatsControl?.value <= 1"
            >
              -
            </button>
            <input
              id="degats"
              type="number"
              formControlName="degats"
              min="1"
              max="40"
              [class.error]="hasError('degats', 'min') || hasError('degats', 'max')"
            />
            <button
              type="button"
              (click)="incrementStat('degats')"
              [disabled]="getRemainingPoints() <= 0"
            >
              +
            </button>
          </div>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="((degatsControl?.value || 0) / 40) * 100"></div>
          </div>
          @if (hasError('degats', 'min') || hasError('degats', 'max')) {
          <div class="field-error">{{ getErrorMessage('degats') }}</div>
          }
        </div>

        <!-- Points de vie -->
        <div class="stat-item">
          <label for="pv">Points de vie:</label>
          <div class="stat-control">
            <button type="button" (click)="decrementStat('pv')" [disabled]="pvControl?.value <= 1">
              -
            </button>
            <input
              id="pv"
              type="number"
              formControlName="pv"
              min="1"
              max="40"
              [class.error]="hasError('pv', 'min') || hasError('pv', 'max')"
            />
            <button
              type="button"
              (click)="incrementStat('pv')"
              [disabled]="getRemainingPoints() <= 0"
            >
              +
            </button>
          </div>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="((pvControl?.value || 0) / 40) * 100"></div>
          </div>
          @if (hasError('pv', 'min') || hasError('pv', 'max')) {
          <div class="field-error">{{ getErrorMessage('pv') }}</div>
          }
        </div>
      </div>

      <!-- √âdition du nom -->
      <div class="name-edit">
        <label for="name">Nom du h√©ros:</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          placeholder="Nom du h√©ros"
          [class.error]="hasError('name', 'required') || hasError('name', 'minlength')"
        />
        @if (hasError('name', 'required') || hasError('name', 'minlength')) {
        <div class="field-error">{{ getErrorMessage('name') }}</div>
        }
      </div>

      <!-- Message d'erreur global -->
      @if (heroForm.hasError('totalExceeded')) {
      <div class="error-message">
        ‚ö†Ô∏è Le total des caract√©ristiques ne peut pas d√©passer 40 points ! (Actuel:
        {{ heroForm.errors?.['totalExceeded']?.actual }})
      </div>
      }

      <!-- Actions -->
      <div class="actions">
        <button type="button" (click)="resetStats()" class="reset-btn">R√©initialiser</button>
        <button
          type="submit"
          [disabled]="heroForm.invalid || !canEquipSelectedWeapon()"
          class="save-btn"
        >
          Sauvegarder & Retour
        </button>
        <button type="button" (click)="goBack()" class="back-btn">Retour</button>
      </div>
    </div>
  </form>
</div>
}

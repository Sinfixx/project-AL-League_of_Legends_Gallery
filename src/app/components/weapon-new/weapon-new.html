<div class="weapon-new">
  <h2>üó°Ô∏è Cr√©er une nouvelle arme</h2>

  <form [formGroup]="weaponForm" (ngSubmit)="onSubmit()" class="weapon-form">
    <div class="form-section">
      <!-- ID -->
      <div class="form-group">
        <label for="id">ID de l'arme:</label>
        <input
          id="id"
          type="number"
          formControlName="id"
          placeholder="ID unique"
          min="1"
          [class.error]="hasError('id', 'required') || hasError('id', 'min') || idWarning"
        />
        @if (hasError('id', 'required') || hasError('id', 'min')) {
        <div class="field-error">{{ getErrorMessage('id') }}</div>
        } @if (idWarning) {
        <div class="field-warning">{{ idWarning }}</div>
        }
      </div>

      <!-- Nom -->
      <div class="form-group">
        <label for="name">Nom de l'arme:</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          placeholder="Ex: Affliction de Liandry"
          [class.error]="hasError('name', 'required') || hasError('name', 'minlength')"
        />
        @if (hasError('name', 'required') || hasError('name', 'minlength')) {
        <div class="field-error">{{ getErrorMessage('name') }}</div>
        }
      </div>
    </div>

    <div class="stats-section">
      <h3>Modificateurs de stats (Total: {{ getTotalStats() }})</h3>

      <div class="balance-indicator">
        <span class="balance-label">√âquilibre:</span>
        <span
          class="balance-value"
          [class.balanced]="getTotalStats() === 0"
          [class.unbalanced]="getTotalStats() !== 0"
        >
          {{ getTotalStats() === 0 ? '√âquilibr√©e ‚öñÔ∏è' : 'D√©s√©quilibr√©e ‚ö†Ô∏è' }}
        </span>
      </div>

      <div class="stats-grid">
        <!-- Attaque -->
        <div class="stat-item">
          <label for="attaque">Attaque:</label>
          <div class="stat-control">
            <button
              type="button"
              (click)="decrementStat('attaque')"
              [disabled]="attaqueControl?.value <= -5"
            >
              -
            </button>
            <input
              id="attaque"
              type="number"
              formControlName="attaque"
              min="-5"
              max="5"
              [class.error]="hasError('attaque', 'min') || hasError('attaque', 'max')"
              [class]="getStatClass(attaqueControl?.value || 0)"
            />
            <button
              type="button"
              (click)="incrementStat('attaque')"
              [disabled]="attaqueControl?.value >= 5"
            >
              +
            </button>
          </div>
          <div class="stat-bar">
            <div
              class="stat-fill"
              [style.width.%]="getStatBarWidth(attaqueControl?.value)"
              [class]="getStatClass(attaqueControl?.value || 0)"
            ></div>
          </div>
          @if (hasError('attaque', 'min') || hasError('attaque', 'max')) {
          <div class="field-error">{{ getErrorMessage('attaque') }}</div>
          }
        </div>

        <!-- Esquive -->
        <div class="stat-item">
          <label for="esquive">Esquive:</label>
          <div class="stat-control">
            <button
              type="button"
              (click)="decrementStat('esquive')"
              [disabled]="esquiveControl?.value <= -5"
            >
              -
            </button>
            <input
              id="esquive"
              type="number"
              formControlName="esquive"
              min="-5"
              max="5"
              [class.error]="hasError('esquive', 'min') || hasError('esquive', 'max')"
              [class]="getStatClass(esquiveControl?.value || 0)"
            />
            <button
              type="button"
              (click)="incrementStat('esquive')"
              [disabled]="esquiveControl?.value >= 5"
            >
              +
            </button>
          </div>
          <div class="stat-bar">
            <div
              class="stat-fill"
              [style.width.%]="getStatBarWidth(esquiveControl?.value)"
              [class]="getStatClass(esquiveControl?.value || 0)"
            ></div>
          </div>
          @if (hasError('esquive', 'min') || hasError('esquive', 'max')) {
          <div class="field-error">{{ getErrorMessage('esquive') }}</div>
          }
        </div>

        <!-- D√©g√¢ts -->
        <div class="stat-item">
          <label for="degats">D√©g√¢ts:</label>
          <div class="stat-control">
            <button
              type="button"
              (click)="decrementStat('degats')"
              [disabled]="degatsControl?.value <= -5"
            >
              -
            </button>
            <input
              id="degats"
              type="number"
              formControlName="degats"
              min="-5"
              max="5"
              [class.error]="hasError('degats', 'min') || hasError('degats', 'max')"
              [class]="getStatClass(degatsControl?.value || 0)"
            />
            <button
              type="button"
              (click)="incrementStat('degats')"
              [disabled]="degatsControl?.value >= 5"
            >
              +
            </button>
          </div>
          <div class="stat-bar">
            <div
              class="stat-fill"
              [style.width.%]="getStatBarWidth(degatsControl?.value)"
              [class]="getStatClass(degatsControl?.value || 0)"
            ></div>
          </div>
          @if (hasError('degats', 'min') || hasError('degats', 'max')) {
          <div class="field-error">{{ getErrorMessage('degats') }}</div>
          }
        </div>

        <!-- Points de vie -->
        <div class="stat-item">
          <label for="pv">Points de vie:</label>
          <div class="stat-control">
            <button type="button" (click)="decrementStat('pv')" [disabled]="pvControl?.value <= -5">
              -
            </button>
            <input
              id="pv"
              type="number"
              formControlName="pv"
              min="-5"
              max="5"
              [class.error]="hasError('pv', 'min') || hasError('pv', 'max')"
              [class]="getStatClass(pvControl?.value || 0)"
            />
            <button type="button" (click)="incrementStat('pv')" [disabled]="pvControl?.value >= 5">
              +
            </button>
          </div>
          <div class="stat-bar">
            <div
              class="stat-fill"
              [style.width.%]="getStatBarWidth(pvControl?.value)"
              [class]="getStatClass(pvControl?.value || 0)"
            ></div>
          </div>
          @if (hasError('pv', 'min') || hasError('pv', 'max')) {
          <div class="field-error">{{ getErrorMessage('pv') }}</div>
          }
        </div>
      </div>

      <!-- Message d'erreur global -->
      @if (weaponForm.hasError('totalNotZero')) {
      <div class="error-message">
        ‚ö†Ô∏è La somme des modificateurs doit √™tre √©gale √† 0 pour maintenir l'√©quilibre ! (Actuel:
        {{ weaponForm.errors?.['totalNotZero']?.actual }})
      </div>
      }

      <!-- Actions -->
      <div class="actions">
        <button type="button" (click)="resetStats()" class="reset-btn">R√©initialiser Stats</button>
        <button type="submit" [disabled]="weaponForm.invalid || idWarning" class="create-btn">
          Cr√©er l'arme
        </button>
        <button type="button" (click)="cancel()" class="cancel-btn">Annuler</button>
      </div>
    </div>
  </form>
</div>
